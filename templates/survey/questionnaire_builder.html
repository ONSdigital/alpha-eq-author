{% extends "base.html" %}
{% block title %}Setup a new Survey{% endblock %}
{% load staticfiles %}
{% block css %}
  {{ block.super }}
  <link rel="stylesheet" href="{% static "css/simditor.css" %}">
{% endblock css %}
{% block base_body %}
  {{ block.super }}
{% include "includes/navigation.html" %}

<div class="wrapper" ng-app="QBuilder">

  <section class="application" ng-controller="BuilderController as builderCtrl">

    {# This template represents a dnd list and is used by other templates. #}
      {# Changing this can cause pain #}
      {% verbatim %}
  	<script type="text/ng-template" id="list.html">
  		<ul class="question-list" dnd-list="list"
  			dnd-drop="dropCallback(event, index, item)"
  			dnd-allowed-types="['item']"
        ng-class="{dragTarget: dragging && dragging.dndType == 'item'}">
        <li ng-repeat="item in list"
  				dnd-draggable="item"
  				dnd-effect-allowed="move"
  				dnd-moved="list.splice($index, 1)"
  				dnd-selected="models.selected = item"
  				ng-class="{selected: models.selected === item}"
  				ng-include="item.type + '.html'"
          dnd-type="item.dndType" class="my-repeat-animation">
  			</li>
  		</ul>
  	</script>

    <!-- Questions  without Controllers-->
    <text-question></text-question>
    <number-question></number-question>
    <rich-text-question></rich-text-question>
    <question-group></question-group>


  <!-- Radio button Question -->
	<script type="text/ng-template" id="radio_question.html">
		<div class="question-block">

			<radio-question></radio-question>

		</div>
	</script>

       <!-- Check Box Question -->
	<script type="text/ng-template" id="check_box_question.html">
		<div class="question-block">

			<check-box-question></check-box-question>

		</div>
	</script>

  {% endverbatim %}

    <div class="large-12">

      <section class="clearfix builder-canvas">

        <div class="large-10 large-offset-1 columns">

          <div class="row">

            <ul class="breadcrumb">
              <li><a href="{%  url 'survey:index' %}" title="">Home</a></li>
              <li><a href="{%  url 'survey:index' %}" title="">Surveys</a></li>
              <li><a href="" title="">{{  questionnaire.survey.title  }}</a></li>
              <li>Authoring {% verbatim %}{{ models.questionnaire_meta.title }}{% endverbatim %}</li>
            </ul>

          <div>

            <h3 class="q-title-editable" contenteditable ng-model="models.questionnaire_meta.title"></h3>
            <!-- havent figured out where this lives yet <p contenteditable ng-model="models.questionnaire_meta.overview"></p>-->

          </div>

          {% verbatim %}

             <div ng-class="{'empty': list.length == 0}" ng-repeat="list in models.dropzones" class="questionContainer" >
                <div class="dropzone">
                    <div ng-include="'list.html'"></div>
                </div>
            </div>
        </div>


        {% endverbatim %}
      </div>
    </section>


      <div class="tool-panel">
        <div class="authoring-tools">
          <h5>Questionnaire Content</h5>
          <p class="instruction">Drag blocks to the canvas</p>
          {% verbatim %}
          <ul class="q-types ng-cloak">
            <li ng-repeat="item in models.templates"
                dnd-draggable="item"
                dnd-effect-allowed="copy"
                dnd-copied="item.id = item.id + 1"
                dnd-type="item.dndType"
                dnd-dragstart="dragStartCallback(item)"
                dnd-dragend="dragEndCallback(item)">
                <!--<img ng-src="{{ item.icon }}"/>-->
                <i class="fa {{ item.icon }}"></i>
                <span ng-bind="item.description">Loading...</span>
            </li>
          </ul>

          <section class="preview-settings">
          <h5>Preview Mode</h5>
            <div class="onoffswitch">
              <input type="checkbox" name="onoffswitch" class="onoffswitch-checkbox" id="myonoffswitch" ns-checked="models.preview" ng-model="models.preview">
                <label class="onoffswitch-label" for="myonoffswitch">
                  <span class="onoffswitch-inner"></span>
                  <span class="onoffswitch-switch"></span>
                </label>
              </div>

         </section>
          <!-- hide til can figure out how to make this friendly :D <div class="trashcan"
              If you use [] as referenced list, the dropped elements will be lost
              <ul dnd-list="[]">
                  <li style="display:block; width:100%"><img src="/static/img/icons/trash.svg" style="width:100%"></li>
              </ul>
          </div>-->
          {% endverbatim %}
          <input type="submit" class="button small radius save" id="" value="Save Questionnaire" ng-click="saveQuestionnaire(models.dropzones)">
          <a href={%  url 'survey:index' %} class="button small radius preview" ng-click="endEdit()">Back to Dashboard</a>

        {% verbatim %}

            <div class="messages">
                <div ng-repeat="message in messages">
                  <div ng-show="message.success"><span class="success"><i class="fa fa-check"></i>{{message.success}}</span></div>
                  <div ng-show="message.error"><span class="error">{{message.error}}</span></div>
                </div>
            </div>

        {% endverbatim %}

         {% comment %} <a class="button small radius preview">Preview</a>
          <a class="button small radius reset">Reset</a>{% endcomment %}
        </form>

          {% if survey_runner_url %}
            <a href="{{ survey_runner_url }}questionnaire/{{ questionnaire.id }}?preview=True" class="button small radius preview">Preview</a>
          {% endif %}
        </div>
      </div>

  </div>

    {% verbatim %}
    <div class="debug">
      <pre>{{ models.dropzones | json }}</pre>
    </div>
    {% endverbatim %}
  </section>
</div>
{% endblock base_body%}


{% block body_js %}
  {{ block.super }}
  <script src="{% static "js/plugin.js" %}"></script>
  <script src="{% static "js/main.js" %}"></script>
  {# Simditor #}
  <script src="{% static "js/module.js" %}"></script>
  <script src="{% static "js/hotkeys.js" %}"></script>
  <script src="{% static "js/uploader.js" %}"></script>
  <script src="{% static "js/simditor.js" %}"></script>
  {# Angular #}
  <script src="{% static "js/angular.js" %}"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/angular.js/1.5.0-beta.1/angular-animate.js"></script>
  <script src="{% static "js/angular-sanitize.js" %}"></script>
  <script src="{% static "js/angular-drag-and-drop-lists.js" %}"></script>
  <script src="{% static "js/q_builder/config.js" %}"></script>
  <script src="{% static "js/q_builder/directives/ContentEditable.js" %}"></script>
  <script src="{% static "js/q_builder/directives/WysiwygEditor.js" %}"></script>
  <script src="{% static "js/q_builder/directives/confirmdialog.js" %}"></script>
  <script src="{% static "js/q_builder/directives/Tabs.js" %}"></script>
  <script src="{% static "js/q_builder/directives/textQuestion.js" %}"></script>
  <script src="{% static "js/q_builder/directives/numberQuestion.js" %}"></script>
  <script src="{% static "js/q_builder/directives/radioQuestion.js" %}"></script>
  <script src="{% static "js/q_builder/directives/checkBoxQuestion.js" %}"></script>
  <script src="{% static "js/q_builder/directives/richTextQuestion.js" %}"></script>
  <script src="{% static "js/q_builder/directives/setfocus.js" %}"></script>
  <script src="{% static "js/q_builder/directives/questionGroup.js" %}"></script>
  <script src="{% static "js/q_builder/controllers/BuilderController.js" %}"></script>
  <script src="{% static "js/q_builder/app.js" %}"></script>


{% endblock body_js %}
